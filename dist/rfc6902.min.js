!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).rfc6902={})}(this,function(t){"use strict";function e(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function n(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}class r{constructor(t=[""]){this.tokens=t}static fromJSON(t){const n=t.split("/").map(e);if(""!==n[0])throw new Error(`Invalid JSON Pointer: ${t}`);return new r(n)}toString(){return this.tokens.map(n).join("/")}evaluate(t){let e=null,n="",r=t;for(let t=1,o=this.tokens.length;t<o;t++)r=((e=r)||{})[n=this.tokens[t]];return{parent:e,key:n,value:r}}get(t){return this.evaluate(t).value}set(t,e){let n=t;for(let t=1,e=this.tokens.length-1,r=this.tokens[t];t<e;t++)n=(n||{})[r];n&&(n[this.tokens[this.tokens.length-1]]=e)}push(t){this.tokens.push(t)}add(t){const e=this.tokens.concat(String(t));return new r(e)}}const o=Object.prototype.hasOwnProperty;function a(t){if(null==t||"object"!=typeof t)return t;if(t.constructor==Array){const e=t.length,n=new Array(e);for(let r=0;r<e;r++)n[r]=a(t[r]);return n}const e={};for(const n in t)o.call(t,n)&&(e[n]=a(t[n]));return e}const u=Object.prototype.hasOwnProperty;function s(t){return void 0===t?"undefined":null===t?"null":t instanceof Date?"date":Array.isArray(t)?"array":typeof t}function c(t,e){if(t===e)return!0;const n=s(t),r=s(e);return"array"==n&&"array"==r?function(t,e){const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(!c(t[r],e[r]))return!1;return!0}(t,e):"object"==n&&"object"==r&&function(t,e){const n=Object.keys(t),r=Object.keys(e),o=n.length;if(o!==r.length)return!1;for(let r=0;r<o;r++){const o=n[r];if(!u.call(e,o)||!c(t[o],e[o]))return!1}return!0}(t,e)}class i extends Error{constructor(t){super(`Value required at path: ${t}`),this.path=t,this.name="MissingError"}}class l extends Error{constructor(t,e){super(`Test failed: ${t} != ${e}`),this.actual=t,this.expected=e,this.name="TestError",this.actual=t,this.expected=e}}function p(t,e,n){if(Array.isArray(t))if("-"==e)t.push(n);else{const r=parseInt(e,10);t.splice(r,0,n)}else t[e]=n}function f(t,e){if(Array.isArray(t)){const n=parseInt(e,10);t.splice(n,1)}else delete t[e]}class h extends Error{constructor(t){super(`Invalid operation: ${t.op}`),this.operation=t,this.name="InvalidOperationError"}}function d(t,e){switch(e.op){case"add":return function(t,e){const n=r.fromJSON(e.path).evaluate(t);return void 0===n.parent?new i(e.path):(p(n.parent,n.key,a(e.value)),null)}(t,e);case"remove":return function(t,e){const n=r.fromJSON(e.path).evaluate(t);return void 0===n.value?new i(e.path):(f(n.parent,n.key),null)}(t,e);case"replace":return function(t,e){const n=r.fromJSON(e.path).evaluate(t);if(null===n.parent)return new i(e.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new i(e.path)}else if(void 0===n.value)return new i(e.path);return n.parent[n.key]=e.value,null}(t,e);case"move":return function(t,e){const n=r.fromJSON(e.from).evaluate(t);if(void 0===n.value)return new i(e.from);const o=r.fromJSON(e.path).evaluate(t);return void 0===o.parent?new i(e.path):(f(n.parent,n.key),p(o.parent,o.key,n.value),null)}(t,e);case"copy":return function(t,e){const n=r.fromJSON(e.from).evaluate(t);if(void 0===n.value)return new i(e.from);const o=r.fromJSON(e.path).evaluate(t);return void 0===o.parent?new i(e.path):(p(o.parent,o.key,a(n.value)),null)}(t,e);case"test":return function(t,e){const n=r.fromJSON(e.path).evaluate(t);return c(n.value,e.value)?null:new l(n.value,e.value)}(t,e)}return new h(e)}const v=Object.prototype.hasOwnProperty;function y({op:t}){return"remove"===t||"replace"===t||"copy"===t||"move"===t}function g(t,e){const n={};for(const e in t)v.call(t,e)&&void 0!==t[e]&&(n[e]=1);for(const t in e)v.call(e,t)&&void 0!==e[t]&&delete n[t];return Object.keys(n)}function m(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function O(t,e,n,r=S){const o=[];return g(t,e).forEach(t=>{o.push({op:"remove",path:n.add(t).toString()})}),g(e,t).forEach(t=>{o.push({op:"add",path:n.add(t).toString(),value:e[t]})}),function(t){const e=t.length,n={};for(let r=0;r<e;r++){const e=t[r];for(const t in e)v.call(e,t)&&void 0!==e[t]&&(n[t]=(n[t]||0)+1)}for(const t in n)n[t]<e&&delete n[t];return Object.keys(n)}([t,e]).forEach(a=>{o.push(...r(t[a],e[a],n.add(a)))}),o}function S(t,e,n,r=S){const o=s(t),a=s(e);return"array"==o&&"array"==a?function(t,e,n,r=S){const o={"0,0":{operations:[],cost:0}},a=isNaN(t.length)||t.length<=0?0:t.length,u=isNaN(e.length)||e.length<=0?0:e.length,s=function n(r,a){const u=`${r},${a}`;let s=o[u];if(void 0===s){if(r>0&&a>0&&c(t[r-1],e[a-1]))s=n(r-1,a-1);else{const o=[];if(r>0){const t=n(r-1,a),e={op:"remove",index:r-1};o.push(m(t,e))}if(a>0){const t=n(r,a-1),u={op:"add",index:r-1,value:e[a-1]};o.push(m(t,u))}if(r>0&&a>0){const u=n(r-1,a-1),s={op:"replace",index:r-1,original:t[r-1],value:e[a-1]};o.push(m(u,s))}s=o.sort((t,e)=>t.cost-e.cost)[0]}o[u]=s}return s}(a,u).operations,[i]=s.reduce(([t,e],o)=>{if(function(t){return"add"===t.op}(o)){const r=o.index+1+e,u=r<a+e?String(r):"-",s={op:o.op,path:n.add(u).toString(),value:o.value};return[t.concat(s),e+1]}if(function(t){return"remove"===t.op}(o)){const r={op:o.op,path:n.add(String(o.index+e)).toString()};return[t.concat(r),e-1]}{const a=n.add(String(o.index+e)),u=r(o.original,o.value,a);return[t.concat(...u),e]}},[[],0]);return i}(t,e,n,r):"object"==o&&"object"==a?O(t,e,n,r):"date"==o&&"date"==a?function(t,e,n){return JSON.stringify(t)!=JSON.stringify(e)?[{op:"replace",path:n.toString(),value:e}]:[]}(t,e,n):function(t,e,n){return c(t,e)?[]:[{op:"replace",path:n.toString(),value:e}]}(t,e,n)}function k(t,e){const n=r.fromJSON(e).evaluate(t);if(void 0!==n)return{op:"test",path:e,value:n.value}}t.applyPatch=function(t,e){return e.map(e=>d(t,e))},t.createPatch=function(t,e,n){const o=new r;return(n?function(t){return function e(n,r,o){const a=t(n,r,o);return Array.isArray(a)?a:S(n,r,o,e)}}(n):S)(t,e,o)},t.createTests=function(t,e){const n=new Array;return e.filter(y).forEach(e=>{const r=k(t,e.path);if(r&&n.push(r),"from"in e){const r=k(t,e.from);r&&n.push(r)}}),n},Object.defineProperty(t,"__esModule",{value:!0})});